#!/usr/bin/env nu

use utils.nu *

alias password-manager-tools = bun run cli

def help [] {
  $'
test manual
  '
  | str trim
}

def main [
  -h
  ...args: string
] {
  if $h {
    help | less --RAW-CONTROL-CHARS
    return
  }

  echo ...$args
}

def 'main edit' [path: string] {
  vi -u NONE -U NONE $path
}

def 'main t' [...args: string] {
  bun run test ...$args
}

def 'main t watch' [...args: string] {
  bun run test --watch ...$args
}

def 'main t reset' [] {
  cp src/__tests__/fixtures/bitwarden.json data
  cp src/__tests__/fixtures/bitwardenEncrypted.json data
}

def 'main t requirefix' [] {
  password-manager-tools convert bitwarden-to-apple src/__tests__/fixtures/bitwarden.json data/output.csv 
}

def 'main t exported' [] {
  password-manager-tools convert bitwarden-to-apple src/__tests__/fixtures/bitwarden.json data/output.csv --include-types note
}

def 'main t remaining' [] {
  password-manager-tools convert bitwarden-to-apple src/__tests__/fixtures/bitwarden.json data/output.csv --include-uris foo.com --output-remaining overwrite-input-file
}

def 'main t password' [] {
  password-manager-tools convert bitwarden-to-apple src/__tests__/fixtures/bitwardenEncrypted.json data/output.csv
}

def 'main convert' [includeUris: string] {
  let cmd = "password-manager-tools convert bitwarden-to-apple data/bitwarden.json data/output.csv"

  if $includeUris != null {
    run-cmd $'($cmd) --include-uris ($includeUris)'
  } else {
    run-cmd $cmd 
  }
}